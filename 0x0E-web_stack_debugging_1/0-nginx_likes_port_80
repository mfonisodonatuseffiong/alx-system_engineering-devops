#!/usr/bin/env bash
# This script configures Nginx to listen on port 80

# Update package lists
sudo apt-get update -y

# Install Nginx if not installed
sudo apt-get install -y nginx

# Start and enable Nginx service
sudo systemctl start nginx
sudo systemctl enable nginx

# Check if the configuration file exists
if [ -f /etc/nginx/sites-enabled/default ]; then
  # Open the 80 port by modifying the configuration file
  sudo sed -i 's/listen 80 default_server;/listen 80 default_server;/' /etc/nginx/sites-available/default
  sudo sed -i 's/listen \[::\]:80 default_server;/listen \[::\]:80 default_server;/' /etc/nginx/sites-available/default
  
  # Restart the Nginx service to apply changes
  sudo service nginx restart

  # Check if Nginx is running and listening on port 80
  sudo netstat -tulnp | grep nginx
else
  echo "Nginx configuration file not found. Exiting."
  exit 1
fi

# Allow Nginx through the firewall
sudo ufw allow 'Nginx Full'
sudo ufw reload
